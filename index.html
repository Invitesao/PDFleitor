<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Confirma√ß√£o de Presen√ßa</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Georgia&family=Cormorant+Garamond:ital,wght@0,400;0,700;1,400&family=Crimson+Text:ital,wght@0,400;0,700;1,400&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');
        
        body {
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .elegant-font {
            font-family: 'Playfair Display', serif;
            font-style: italic;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        #toggle-dot {
            transition: transform 0.3s ease;
        }

        #toggle-aviso-criancas:checked ~ #toggle-dot,
        #toggle-recados-publicos:checked ~ #toggle-dot-recados {
            transform: translateX(24px);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app-container" class="h-full w-full overflow-auto" style="background-color: #faf8f5;"><!-- P√ÅGINA DO CONVIDADO -->
   <div id="guest-page" class="min-h-full py-12 px-4">
    <div class="max-w-2xl mx-auto"><!-- Cabe√ßalho Elegante -->
     <div class="text-center mb-10 fade-in">
      <h1 id="nome-aniversariante" class="text-5xl md:text-6xl font-bold mb-3 elegant-font" style="color: #6f0000;">Carregando...</h1>
      <div class="h-6"></div>
      <p id="data-evento" class="text-lg" style="color: #6f0000;">...</p>
     </div><!-- Contagem Regressiva -->
     <div class="bg-white rounded-2xl shadow-sm p-6 mb-6 fade-in border" style="animation-delay: 0.2s; border-color: #e5ddd5;">
      <h2 class="text-xl font-semibold text-center mb-4" style="color: #6f0000;">Contagem Regressiva</h2>
      <div id="countdown" class="grid grid-cols-4 gap-3"><!-- Countdown ser√° preenchido via JavaScript -->
      </div>
     </div><!-- Aviso de Data Limite -->
     <div id="aviso-data-limite" class="bg-gradient-to-r from-red-50 to-pink-50 rounded-xl shadow-sm p-5 mb-6 text-center fade-in border-2 pulse-animation" style="animation-delay: 0.25s; border-color: #ef4444; display: none;">
      <p class="text-lg font-bold mb-1" style="color: #991b1b;">‚è∞ Aten√ß√£o!</p>
      <p id="texto-data-limite" class="text-base" style="color: #7f1d1d;">Por favor, confirme sua presen√ßa at√© <strong id="data-limite-display">--/--/----</strong></p>
     </div><!-- Aviso Importante -->
     <div id="aviso-container" class="bg-white rounded-xl shadow-sm p-4 mb-6 text-center fade-in border" style="animation-delay: 0.3s; border-color: #e5ddd5;">
      <p id="aviso-criancas" class="text-base" style="color: #5d5d5d;">...</p>
     </div><!-- Formul√°rio de Confirma√ß√£o -->
     <div id="form-section" class="bg-white rounded-2xl shadow-sm border p-6 md:p-8 fade-in" style="animation-delay: 0.4s; border-color: #e5ddd5;">
      <h2 class="text-2xl font-semibold text-center mb-6" style="color: #6f0000;">Confirme sua Presen√ßa</h2>
      <form id="confirmation-form" class="space-y-5">
       <div><label for="nome-convidado" class="block text-sm font-semibold mb-2" style="color: #5d5d5d;"> Seu Nome Completo * </label> <input type="text" id="nome-convidado" required class="w-full px-4 py-3 border rounded-lg text-base focus:outline-none focus:ring-2 transition-all" style="border-color: #d4c4b0; background-color: #ffffff;" placeholder="Digite seu nome completo">
       </div>
       <div id="acompanhante-field" style="display: none;"><label for="nome-acompanhante" class="block text-sm font-semibold mb-2" style="color: #5d5d5d;"> Nome do Acompanhante </label> <input type="text" id="nome-acompanhante" class="w-full px-4 py-3 border rounded-lg text-base focus:outline-none focus:ring-2 transition-all" style="border-color: #d4c4b0; background-color: #ffffff;" placeholder="Digite o nome do acompanhante">
       </div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><button type="submit" id="submit-button-confirmar" class="py-4 rounded-xl text-white text-lg font-bold transition-all hover:opacity-90 shadow-lg" style="background-color: #10b981;"> Eu Vou Sim! </button> <button type="button" id="submit-button-declinar" class="py-4 rounded-xl text-white text-lg font-bold transition-all hover:opacity-90 shadow-lg" style="background-color: #ef4444;"> N√£o Poderei Ir </button>
       </div>
      </form><!-- Estado de Loading -->
      <div id="loading-state" style="display: none;" class="text-center py-10">
       <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-t-transparent mb-3" style="border-color: #6f0000;"></div>
       <p class="text-base font-semibold" style="color: #6f0000;">Enviando...</p>
      </div><!-- Estado de Sucesso Confirma√ß√£o -->
      <div id="success-state" style="display: none;" class="text-center py-10">
       <div class="text-6xl mb-4">
        üéâ
       </div>
       <h3 class="text-3xl font-bold mb-4" style="color: #10b981;">Confirmado!</h3>
       <p class="text-xl mb-3" style="color: #5d5d5d;">Obrigada por confirmar sua presen√ßa!</p>
       <p class="text-base mb-8" style="color: #999;">Aguardamos voc√™ com muito carinho!</p><button id="editar-resposta-btn" class="px-8 py-4 rounded-xl text-white text-lg font-bold transition-all hover:opacity-90 shadow-lg" style="background-color: #6f0000;"> Mudar Resposta </button>
      </div><!-- Estado de Sucesso Decl√≠nio -->
      <div id="decline-state" style="display: none;" class="text-center py-10">
       <div class="text-6xl mb-4">
        üíî
       </div>
       <h3 class="text-3xl font-bold mb-4" style="color: #6f0000;">Resposta Registrada</h3>
       <p class="text-xl mb-3" style="color: #5d5d5d;">Agradecemos por nos informar!</p>
       <p class="text-base mb-8" style="color: #999;">Sentiremos sua falta!</p><button id="editar-resposta-btn2" class="px-8 py-4 rounded-xl text-white text-lg font-bold transition-all hover:opacity-90 shadow-lg" style="background-color: #6f0000;"> Mudar Resposta </button>
      </div><!-- Mensagem de Erro -->
      <div id="error-message" style="display: none;" class="mt-4 p-3 bg-red-50 border border-red-300 rounded-lg text-center">
       <p class="text-red-700 text-sm font-semibold">Erro ao processar resposta. Tente novamente.</p>
      </div>
     </div><!-- Se√ß√£o de Recados -->
     <div id="recados-section" class="mt-6" style="display: none;">
      <div class="bg-white rounded-2xl shadow-sm border p-6 md:p-8 fade-in" style="animation-delay: 0.5s; border-color: #e5ddd5;">
       <div class="text-center mb-6">
        <h2 class="text-2xl font-semibold mb-2" style="color: #6f0000;">Deixe um Recado</h2>
        <p class="text-base text-gray-600">Envie uma mensagem carinhosa para a aniversariante!</p>
       </div>
       <form id="recado-form" class="mb-8">
        <div class="space-y-4">
         <div id="nome-recado-field"><label for="nome-recado" class="block text-base font-semibold mb-2" style="color: #5d5d5d;"> Seu Nome * </label> <input type="text" id="nome-recado" required class="w-full px-4 py-3 border rounded-lg text-base focus:outline-none focus:ring-2 transition-all" style="border-color: #d4c4b0; background-color: #ffffff;" placeholder="Digite seu nome">
         </div>
         <div><label for="mensagem-recado" class="block text-base font-semibold mb-2" style="color: #5d5d5d;"> Sua Mensagem * </label> <textarea id="mensagem-recado" required rows="4" maxlength="500" class="w-full px-4 py-3 border rounded-lg text-base focus:outline-none focus:ring-2 transition-all resize-none" style="border-color: #d4c4b0; background-color: #ffffff;" placeholder="Escreva sua mensagem de carinho..."></textarea>
          <p class="text-sm text-gray-400 mt-1 text-right" id="char-count">0/500 caracteres</p>
         </div><button type="submit" id="recado-button" class="w-full py-4 rounded-xl text-white text-lg font-bold transition-all hover:opacity-90 shadow-lg" style="background-color: #6f0000;"> Enviar Recado </button>
        </div>
       </form>
       <div id="recado-loading" style="display: none;" class="text-center py-6">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-t-transparent mb-3" style="border-color: #6f0000;"></div>
        <p class="text-base font-semibold" style="color: #6f0000;">Enviando recado...</p>
       </div>
       <div id="recado-success" style="display: none;" class="text-center py-6 bg-green-50 rounded-xl border-2 border-green-300">
        <p class="text-lg font-bold text-green-700">Recado enviado com sucesso!</p>
       </div>
       <div id="recado-error" style="display: none;" class="mt-4 p-4 bg-red-50 border-2 border-red-300 rounded-xl text-center">
        <p class="text-red-700 text-base font-semibold">Erro ao enviar recado. Tente novamente.</p>
       </div>
       <div class="mt-8 border-t-2 pt-6" style="border-color: #e5ddd5;">
        <h3 class="text-xl font-semibold text-center mb-5" style="color: #6f0000;">Recados dos Convidados</h3>
        <div id="lista-recados" class="space-y-3">
         <p class="text-gray-400 text-center py-6 text-base">Nenhum recado ainda. Seja o primeiro!</p>
        </div>
       </div>
      </div>
     </div><!-- Link para Admin -->
     <div id="admin-link" class="text-center mt-6"><button type="button" id="ir-login-btn" class="text-xs opacity-30 hover:opacity-70 transition-opacity cursor-pointer" style="color: #6f0000;"> √Årea do organizador </button>
     </div>
    </div>
   </div><!-- P√ÅGINA DE LOGIN ADMIN -->
   <div id="login-page" style="display: none;" class="min-h-full flex items-center justify-center px-4">
    <div class="bg-white rounded-3xl shadow-2xl p-10 max-w-md w-full">
     <div class="text-center mb-8">
      <h2 class="text-3xl font-bold elegant-font" style="color: #8B0000;">√Årea do Organizador</h2>
     </div>
     <form id="login-form" class="space-y-5">
      <div><label for="admin-username" class="block text-sm font-semibold mb-2" style="color: #8B0000;"> Usu√°rio </label> <input type="text" id="admin-username" required autocomplete="off" class="w-full px-4 py-3 border-2 rounded-xl focus:outline-none" style="border-color: #8B0000;">
      </div>
      <div><label for="admin-password" class="block text-sm font-semibold mb-2" style="color: #8B0000;"> Senha </label> <input type="password" id="admin-password" required autocomplete="new-password" class="w-full px-4 py-3 border-2 rounded-xl focus:outline-none" style="border-color: #8B0000;">
      </div>
      <div id="login-error" style="display: none;" class="text-sm text-center p-3 bg-red-100 border border-red-400 rounded-xl text-red-800">
       Usu√°rio ou senha incorretos
      </div><button type="submit" class="w-full py-4 rounded-xl text-white font-bold text-lg hover:opacity-90 transition-all" style="background-color: #8B0000;"> Entrar </button>
     </form><button id="voltar-button" class="w-full mt-5 py-3 text-sm font-semibold hover:underline" style="color: #8B0000; display: none;"> Voltar para p√°gina de convidado </button>
    </div>
   </div><!-- P√ÅGINA ADMIN -->
   <div id="admin-page" style="display: none;" class="min-h-full py-10 px-4">
    <div class="max-w-7xl mx-auto"><!-- Cabe√ßalho Admin -->
     <div class="mb-10">
      <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-3xl p-8 mb-6 border-4" style="border-color: #FFD700;">
       <h1 class="text-4xl font-bold elegant-font text-center mb-3" style="color: #8B0000;">Painel do Organizador</h1>
       <p class="text-center text-gray-600 text-lg">Aqui voc√™ gerencia todas as confirma√ß√µes do seu evento</p>
      </div>
      <div class="flex flex-wrap justify-center gap-4"><button id="mostrar-ajuda-btn" class="px-8 py-4 rounded-xl text-white font-bold shadow-lg hover:opacity-90 transition-all text-lg" style="background-color: #4299e1;"> Como Usar Este Painel </button> <button id="exportar-pdf-btn" class="px-8 py-4 rounded-xl text-white font-bold shadow-lg hover:opacity-90 transition-all text-lg" style="background-color: #FFD700; color: #8B0000;"> Baixar Lista em PDF </button> <button id="logout-btn" class="px-8 py-4 rounded-xl text-white font-bold shadow-lg hover:opacity-90 transition-all text-lg" style="background-color: #8B0000;"> Sair </button>
      </div>
     </div><!-- Estat√≠sticas -->
     <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-10">
      <div class="bg-white rounded-2xl p-8 shadow-xl text-center">
       <div class="text-5xl font-bold mb-2" style="color: #8B0000;" id="stat-confirmados">
        0
       </div>
       <div class="text-gray-600 text-lg font-semibold">
        Confirmados
       </div>
      </div>
      <div class="bg-white rounded-2xl p-8 shadow-xl text-center">
       <div class="text-5xl font-bold mb-2" style="color: #666;" id="stat-declinados">
        0
       </div>
       <div class="text-gray-600 text-lg font-semibold">
        Declinaram
       </div>
      </div>
      <div class="bg-white rounded-2xl p-8 shadow-xl text-center">
       <div class="text-5xl font-bold mb-2" style="color: #8B0000;" id="stat-acompanhantes">
        0
       </div>
       <div class="text-gray-600 text-lg font-semibold">
        Com Acompanhante
       </div>
      </div>
      <div class="bg-white rounded-2xl p-8 shadow-xl text-center">
       <div class="text-5xl font-bold mb-2" style="color: #8B0000;" id="stat-pessoas">
        0
       </div>
       <div class="text-gray-600 text-lg font-semibold">
        Total de Pessoas
       </div>
      </div>
      <div class="bg-white rounded-2xl p-8 shadow-xl text-center">
       <div class="text-5xl font-bold mb-2" style="color: #8B0000;" id="stat-recados">
        0
       </div>
       <div class="text-gray-600 text-lg font-semibold">
        Recados
       </div>
      </div>
     </div><!-- Tabs -->
     <div class="mb-6">
      <div class="bg-white rounded-2xl shadow-lg p-4 mb-4">
       <p class="text-center text-gray-600 text-base"><strong>Clique nas abas abaixo</strong> para ver diferentes informa√ß√µes</p>
      </div>
      <div class="flex flex-wrap gap-4 justify-center"><button id="tab-confirmados" class="px-8 py-4 rounded-xl font-bold text-white shadow-lg text-lg" style="background-color: #8B0000;"> Confirmados </button> <button id="tab-declinados" class="px-8 py-4 rounded-xl font-bold shadow-lg text-lg" style="background-color: #e5e7eb; color: #666;"> Declinaram </button> <button id="tab-recados" class="px-8 py-4 rounded-xl font-bold shadow-lg text-lg" style="background-color: #e5e7eb; color: #666;"> Recados </button> <button id="tab-links" class="px-8 py-4 rounded-xl font-bold shadow-lg text-lg" style="background-color: #e5e7eb; color: #666;"> Enviar Convites </button>
      </div>
     </div><!-- Conte√∫do das Tabs -->
     <div id="content-confirmados" class="bg-white rounded-3xl shadow-2xl p-8">
      <h2 class="text-3xl font-bold mb-6 elegant-font" style="color: #8B0000;">Confirma√ß√µes Recebidas</h2>
      <div id="confirmations-list" class="space-y-4">
       <p class="text-gray-400 text-center py-12 text-lg">Nenhuma confirma√ß√£o ainda</p>
      </div>
     </div>
     <div id="content-declinados" class="bg-white rounded-3xl shadow-2xl p-8" style="display: none;">
      <h2 class="text-3xl font-bold mb-6 elegant-font" style="color: #8B0000;">Pessoas que Declinaram</h2>
      <div id="declines-list" class="space-y-4">
       <p class="text-gray-400 text-center py-12 text-lg">Ningu√©m declinou ainda</p>
      </div>
     </div>
     <div id="content-recados" class="bg-white rounded-3xl shadow-2xl p-8" style="display: none;">
      <h2 class="text-3xl font-bold mb-6 elegant-font" style="color: #8B0000;">Recados Recebidos</h2>
      <div id="admin-recados-list" class="space-y-4">
       <p class="text-gray-400 text-center py-12 text-lg">Nenhum recado ainda</p>
      </div>
     </div><!-- Aba Links -->
     <div id="content-links" class="bg-white rounded-3xl shadow-2xl p-8" style="display: none;">
      <div class="text-center mb-8">
       <h2 class="text-3xl font-bold mb-3 elegant-font" style="color: #8B0000;">Como Enviar os Convites</h2>
       <p class="text-lg text-gray-600">Siga os passos abaixo para convidar as pessoas</p>
      </div><!-- Tutorial Visual -->
      <div class="bg-blue-50 rounded-2xl p-6 mb-8 border-2 border-blue-300">
       <h3 class="text-xl font-bold mb-4 text-blue-900">Tutorial Passo a Passo:</h3>
       <div class="space-y-3 text-gray-700">
        <div class="flex items-start gap-3">
         <div class="bg-blue-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
          1
         </div>
         <p class="text-base"><strong>Escolha o link correto</strong> (com ou sem acompanhante)</p>
        </div>
        <div class="flex items-start gap-3">
         <div class="bg-blue-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
          2
         </div>
         <p class="text-base"><strong>Clique no bot√£o "Copiar"</strong> - o link ser√° copiado automaticamente</p>
        </div>
        <div class="flex items-start gap-3">
         <div class="bg-blue-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
          3
         </div>
         <p class="text-base"><strong>Cole no WhatsApp, SMS ou Email</strong> e envie para seus convidados</p>
        </div>
       </div>
      </div><!-- Links -->
      <div class="space-y-6 mb-8">
       <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-6 border-2" style="border-color: #10b981;">
        <div class="flex items-center gap-3 mb-4">
         <div>
          <h4 class="text-xl font-bold" style="color: #047857;">Link para Pessoa SOZINHA</h4>
          <p class="text-sm text-gray-600">Use este link para quem vai sozinho (sem acompanhante)</p>
         </div>
        </div>
        <div class="flex gap-3"><input type="text" id="link-sem" readonly class="flex-1 px-4 py-3 rounded-xl text-base border-2 bg-white" style="border-color: #10b981;"> <button id="copiar-sem-btn" class="px-8 py-3 rounded-xl text-white font-bold text-lg whitespace-nowrap hover:opacity-90 transition-all" style="background-color: #10b981;"> Copiar </button>
        </div>
       </div>
       <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border-2" style="border-color: #a855f7;">
        <div class="flex items-center gap-3 mb-4">
         <div>
          <h4 class="text-xl font-bold" style="color: #7c3aed;">Link para Pessoa COM ACOMPANHANTE</h4>
          <p class="text-sm text-gray-600">Use este link para quem pode levar 1 acompanhante</p>
         </div>
        </div>
        <div class="flex gap-3"><input type="text" id="link-com" readonly class="flex-1 px-4 py-3 rounded-xl text-base border-2 bg-white" style="border-color: #a855f7;"> <button id="copiar-com-btn" class="px-8 py-3 rounded-xl text-white font-bold text-lg whitespace-nowrap hover:opacity-90 transition-all" style="background-color: #a855f7;"> Copiar </button>
        </div>
       </div>
      </div>
      <div id="copy-success" style="display: none;" class="text-center p-4 bg-green-100 border-2 border-green-400 rounded-xl mb-6">
       <p class="text-green-800 font-bold text-lg">Link copiado! Agora √© s√≥ colar no WhatsApp ou outro app</p>
      </div><!-- Personaliza√ß√£o -->
      <div class="border-t-4 pt-8 mt-8" style="border-color: #e5ddd5;">
       <h3 class="text-2xl font-bold mb-6 elegant-font text-center" style="color: #8B0000;">Personalizar Convite</h3>
       <div class="space-y-6">
        <div class="bg-gradient-to-r from-amber-50 to-yellow-50 rounded-2xl p-6 border-2" style="border-color: #f59e0b;"><label class="block text-lg font-bold mb-3" style="color: #92400e;"> Nome da Aniversariante: </label> <input type="text" id="edit-nome" class="w-full px-4 py-3 rounded-xl text-lg border-2 bg-white mb-4" style="border-color: #f59e0b;"> <button id="salvar-config-btn" class="w-full py-3 rounded-xl text-white font-bold text-lg hover:opacity-90 transition-all" style="background-color: #8B0000;"> Salvar Altera√ß√µes </button>
        </div>
        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl p-6 border-2" style="border-color: #3b82f6;"><label class="block text-lg font-bold mb-3" style="color: #1e40af;"> Data do Evento (texto que aparece no convite): </label> <input type="text" id="edit-data" class="w-full px-4 py-3 rounded-xl text-lg border-2 bg-white mb-6" style="border-color: #3b82f6;" placeholder="Ex: 15 de Janeiro de 2026, √†s 20:00"> <label class="block text-lg font-bold mb-3" style="color: #1e40af;"> üìÖ Data e Hora EXATA do Evento (para contagem regressiva): </label>
         <div class="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4 mb-3">
          <p class="text-sm text-yellow-900 font-bold mb-2">‚ö†Ô∏è IMPORTANTE:</p>
          <p class="text-sm text-yellow-800">Coloque aqui a data e hora EXATA do anivers√°rio para a contagem regressiva funcionar!</p>
         </div><input type="datetime-local" id="edit-data-evento-timestamp" class="w-full px-4 py-3 rounded-xl text-lg border-2 bg-white mb-6" style="border-color: #3b82f6;"> <label class="block text-lg font-bold mb-3" style="color: #1e40af;"> Data Limite para Confirma√ß√£o: </label> <input type="date" id="edit-data-limite" class="w-full px-4 py-3 rounded-xl text-lg border-2 bg-white" style="border-color: #3b82f6;">
         <p class="text-sm text-gray-600 mt-2">Ap√≥s esta data, os convidados n√£o poder√£o mais confirmar presen√ßa</p>
        </div>
        <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-2xl p-6 border-2" style="border-color: #ef4444;"><label class="block text-lg font-bold mb-3" style="color: #991b1b;"> Texto do Aviso: </label> <input type="text" id="edit-aviso" class="w-full px-4 py-3 rounded-xl text-lg border-2 bg-white mb-4" style="border-color: #ef4444;">
         <div class="flex items-center justify-between">
          <div class="flex-1"><label class="block text-base font-bold" style="color: #991b1b;"> Mostrar aviso </label>
           <p class="text-sm text-gray-600 mt-1">Clique no bot√£o ao lado para ligar/desligar</p>
          </div>
          <div class="relative ml-4"><input type="checkbox" id="toggle-aviso-criancas" class="sr-only" checked>
           <div id="toggle-bg" class="block w-16 h-9 rounded-full transition-colors cursor-pointer" style="background-color: #6f0000;"></div>
           <div id="toggle-dot" class="dot absolute left-1 top-1 bg-white w-7 h-7 rounded-full transition-transform pointer-events-none"></div>
          </div>
         </div>
        </div>
        <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-2xl p-6 border-2" style="border-color: #8b5cf6;"><label class="block text-lg font-bold mb-3" style="color: #5b21b6;"> Recados dos Convidados: </label>
         <div class="flex items-center justify-between">
          <div class="flex-1"><label class="block text-base font-bold" style="color: #5b21b6;"> Permitir que convidados vejam recados de outros </label>
           <p class="text-sm text-gray-600 mt-1">Quando ativado, todos os recados ficam vis√≠veis para quem entrar no link</p>
          </div>
          <div class="relative ml-4"><input type="checkbox" id="toggle-recados-publicos" class="sr-only" checked>
           <div id="toggle-bg-recados" class="block w-16 h-9 rounded-full transition-colors cursor-pointer" style="background-color: #6f0000;"></div>
           <div id="toggle-dot-recados" class="dot absolute left-1 top-1 bg-white w-7 h-7 rounded-full transition-transform pointer-events-none"></div>
          </div>
         </div>
        </div>
        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-6 border-2" style="border-color: #6366f1;"><label class="block text-lg font-bold mb-3" style="color: #4338ca;"> Usu√°rio Admin: </label> <input type="text" id="edit-username" class="w-full px-4 py-3 rounded-xl text-lg border-2 bg-white mb-3" style="border-color: #6366f1;"> <label class="block text-lg font-bold mb-3 mt-4" style="color: #4338ca;"> Senha Admin: </label> <input type="password" id="edit-password" class="w-full px-4 py-3 rounded-xl text-lg border-2 bg-white" style="border-color: #6366f1;">
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
        // ==================== CONFIGURA√á√ÉO SUPABASE ====================
        const CONFIG = {
            supabaseUrl: 'https://ybbhynfttwogkdsnqmvu.supabase.co',
            supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InliYmh5bmZ0dHdvZ2tkc25xbXZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY3MDIsImV4cCI6MjA3MTI1MjcwMn0.LPMGW_OPKiwTEKhyzl_v2Snb9nVeZg0wP4Ot6zKrCn0'
        };

        let supabaseClient;
        
        if (window.supabase && window.supabase.createClient) {
            supabaseClient = window.supabase.createClient(CONFIG.supabaseUrl, CONFIG.supabaseKey);
        }

        // ==================== VARI√ÅVEIS GLOBAIS ====================
        let todasConfirmacoes = [];
        let todosRecados = [];
        let permitirAcompanhante = false;
        let isAdminLogado = false;
        let usuarioRespondeu = false;
        let nomeConvidadoAtual = '';
        let temLinkValido = false;
        let configuracaoEvento = {
            nome_aniversariante: 'Catarina Bastos Pires',
            data_evento: '15 de Janeiro de 2026',
            aviso_criancas: 'Por favor, n√£o levar crian√ßas',
            mostrar_aviso: true,
            admin_username: 'catarina',
            admin_password: 'catarina2026',
            data_evento_timestamp: new Date('2026-01-15T20:00:00').getTime(),
            data_limite_confirmacao: null,
            mostrar_recados_publicos: true
        };

        // ==================== CARREGAR CONFIGURA√á√ÉO ====================
        async function carregarConfiguracao() {
            if (!supabaseClient) return;
            
            try {
                const { data, error } = await supabaseClient
                    .from('configuracao')
                    .select('*')
                    .limit(1)
                    .single();

                if (data) {
                    configuracaoEvento = {
                        nome_aniversariante: data.nome_aniversariante || configuracaoEvento.nome_aniversariante,
                        data_evento: data.data_evento || configuracaoEvento.data_evento,
                        aviso_criancas: data.aviso_criancas || configuracaoEvento.aviso_criancas,
                        mostrar_aviso: data.mostrar_aviso !== undefined ? data.mostrar_aviso : configuracaoEvento.mostrar_aviso,
                        admin_username: data.admin_username || configuracaoEvento.admin_username,
                        admin_password: data.admin_password || configuracaoEvento.admin_password,
                        data_evento_timestamp: data.data_evento_timestamp || configuracaoEvento.data_evento_timestamp,
                        data_limite_confirmacao: data.data_limite_confirmacao || null,
                        mostrar_recados_publicos: data.mostrar_recados_publicos !== undefined ? data.mostrar_recados_publicos : configuracaoEvento.mostrar_recados_publicos
                    };
                }
            } catch (err) {
                console.error('Erro ao carregar configura√ß√£o:', err);
            }

            atualizarInterfaceConvidado();
            verificarDataLimite();
        }

        function atualizarInterfaceConvidado() {
            document.getElementById('nome-aniversariante').textContent = configuracaoEvento.nome_aniversariante;
            document.getElementById('data-evento').textContent = configuracaoEvento.data_evento;
            document.getElementById('aviso-criancas').textContent = configuracaoEvento.aviso_criancas;
            
            const avisoContainer = document.getElementById('aviso-container');
            avisoContainer.style.display = configuracaoEvento.mostrar_aviso ? 'block' : 'none';

            // Atualizar visibilidade dos recados p√∫blicos
            const listaRecados = document.getElementById('lista-recados');
            if (configuracaoEvento.mostrar_recados_publicos) {
                listaRecados.style.display = 'block';
                renderizarRecados();
            } else {
                listaRecados.innerHTML = '<p class="text-gray-400 text-center py-6 text-base">Os recados est√£o desativados no momento.</p>';
            }

            // Atualizar aviso de data limite - SEMPRE mostra se existir data
            const avisoDataLimite = document.getElementById('aviso-data-limite');
            const dataLimiteDisplay = document.getElementById('data-limite-display');
            
            if (configuracaoEvento.data_limite_confirmacao && configuracaoEvento.data_limite_confirmacao.trim() !== '') {
                try {
                    const dataLimite = new Date(configuracaoEvento.data_limite_confirmacao + 'T23:59:59');
                    const dataFormatada = dataLimite.toLocaleDateString('pt-BR', { 
                        day: '2-digit', 
                        month: 'long', 
                        year: 'numeric' 
                    });
                    
                    if (dataLimiteDisplay) {
                        dataLimiteDisplay.textContent = dataFormatada;
                    }
                    if (avisoDataLimite) {
                        avisoDataLimite.style.display = 'block';
                    }
                } catch (err) {
                    console.error('Erro ao processar data limite:', err);
                    if (avisoDataLimite) {
                        avisoDataLimite.style.display = 'none';
                    }
                }
            } else {
                if (avisoDataLimite) {
                    avisoDataLimite.style.display = 'none';
                }
            }
        }

        // ==================== VERIFICAR DATA LIMITE ====================
        function verificarDataLimite() {
            if (!configuracaoEvento.data_limite_confirmacao) return;
            
            const dataLimite = new Date(configuracaoEvento.data_limite_confirmacao);
            dataLimite.setHours(23, 59, 59, 999);
            const agora = new Date();
            
            if (agora > dataLimite) {
                const formSection = document.getElementById('form-section');
                formSection.innerHTML = `
                    <div class="text-center py-10">
                        <div class="text-6xl mb-4">‚è∞</div>
                        <h3 class="text-2xl font-bold mb-4" style="color: #6f0000;">
                            Prazo Encerrado
                        </h3>
                        <p class="text-lg text-gray-600 mb-2">
                            O prazo para confirma√ß√£o de presen√ßa encerrou em:
                        </p>
                        <p class="text-xl font-bold" style="color: #6f0000;">
                            ${dataLimite.toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' })}
                        </p>
                    </div>
                `;
                
                const avisoDataLimite = document.getElementById('aviso-data-limite');
                if (avisoDataLimite) {
                    avisoDataLimite.style.display = 'none';
                }
            }
        }

        // ==================== SALVAR CONFIGURA√á√ÉO ====================
        async function salvarConfiguracao() {
            if (!supabaseClient) return;
            
            const novoNome = document.getElementById('edit-nome').value.trim();
            const novaData = document.getElementById('edit-data').value.trim();
            const novoAviso = document.getElementById('edit-aviso').value.trim();
            const novoUsername = document.getElementById('edit-username').value.trim();
            const novoPassword = document.getElementById('edit-password').value.trim();
            const novaDataLimite = document.getElementById('edit-data-limite').value;
            const novaDataEventoTimestamp = document.getElementById('edit-data-evento-timestamp').value;

            if (novoNome) configuracaoEvento.nome_aniversariante = novoNome;
            if (novaData) configuracaoEvento.data_evento = novaData;
            if (novoAviso) configuracaoEvento.aviso_criancas = novoAviso;
            if (novoUsername) configuracaoEvento.admin_username = novoUsername;
            if (novoPassword) configuracaoEvento.admin_password = novoPassword;
            
            configuracaoEvento.data_limite_confirmacao = novaDataLimite || null;
            
            // Atualizar timestamp da data do evento
            if (novaDataEventoTimestamp) {
                configuracaoEvento.data_evento_timestamp = new Date(novaDataEventoTimestamp).getTime();
            }

            try {
                const { data: existing, error: selectError } = await supabaseClient
                    .from('configuracao')
                    .select('*')
                    .limit(1)
                    .single();

                if (selectError && selectError.code !== 'PGRST116') {
                    throw selectError;
                }

                let resultado;
                if (existing) {
                    resultado = await supabaseClient
                        .from('configuracao')
                        .update({
                            nome_aniversariante: configuracaoEvento.nome_aniversariante,
                            data_evento: configuracaoEvento.data_evento,
                            aviso_criancas: configuracaoEvento.aviso_criancas,
                            mostrar_aviso: configuracaoEvento.mostrar_aviso,
                            admin_username: configuracaoEvento.admin_username,
                            admin_password: configuracaoEvento.admin_password,
                            data_evento_timestamp: configuracaoEvento.data_evento_timestamp,
                            data_limite_confirmacao: configuracaoEvento.data_limite_confirmacao,
                            mostrar_recados_publicos: configuracaoEvento.mostrar_recados_publicos
                        })
                        .eq('id', existing.id)
                        .select();
                } else {
                    resultado = await supabaseClient
                        .from('configuracao')
                        .insert([{
                            nome_aniversariante: configuracaoEvento.nome_aniversariante,
                            data_evento: configuracaoEvento.data_evento,
                            aviso_criancas: configuracaoEvento.aviso_criancas,
                            mostrar_aviso: configuracaoEvento.mostrar_aviso,
                            admin_username: configuracaoEvento.admin_username,
                            admin_password: configuracaoEvento.admin_password,
                            data_evento_timestamp: configuracaoEvento.data_evento_timestamp,
                            data_limite_confirmacao: configuracaoEvento.data_limite_confirmacao,
                            mostrar_recados_publicos: configuracaoEvento.mostrar_recados_publicos
                        }])
                        .select();
                }

                if (resultado.error) {
                    throw resultado.error;
                }

                atualizarInterfaceConvidado();
                verificarDataLimite();

                const sucesso = document.createElement('div');
                sucesso.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-100 border-2 border-green-400 px-6 py-3 rounded-xl shadow-lg z-50';
                sucesso.innerHTML = '<p class="text-green-800 font-bold">‚úÖ Configura√ß√µes salvas com sucesso!</p>';
                document.body.appendChild(sucesso);
                setTimeout(() => sucesso.remove(), 3000);
            } catch (err) {
                console.error('Erro ao salvar:', err);
                
                const erro = document.createElement('div');
                erro.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border-2 border-red-400 px-6 py-3 rounded-xl shadow-lg z-50';
                erro.innerHTML = `<p class="text-red-800 font-bold">‚ùå Erro: ${err.message}</p>`;
                document.body.appendChild(erro);
                setTimeout(() => erro.remove(), 5000);
            }
        }

        // ==================== TOGGLE AVISO ====================
        async function toggleAvisoCriancas(mostrar) {
            if (!supabaseClient) return;
            
            configuracaoEvento.mostrar_aviso = mostrar;
            
            try {
                const { data: existing } = await supabaseClient
                    .from('configuracao')
                    .select('id')
                    .limit(1)
                    .single();

                if (existing) {
                    await supabaseClient
                        .from('configuracao')
                        .update({ mostrar_aviso: mostrar })
                        .eq('id', existing.id);
                }
            } catch (err) {
                console.error('Erro ao atualizar aviso:', err);
            }

            atualizarInterfaceConvidado();
            
            const toggleBg = document.getElementById('toggle-bg');
            const toggleDot = document.getElementById('toggle-dot');
            
            if (mostrar) {
                toggleBg.style.backgroundColor = '#6f0000';
                toggleDot.style.transform = 'translateX(24px)';
            } else {
                toggleBg.style.backgroundColor = '#d1d5db';
                toggleDot.style.transform = 'translateX(0)';
            }
        }

        async function toggleRecadosPublicos(mostrar) {
            if (!supabaseClient) return;
            
            configuracaoEvento.mostrar_recados_publicos = mostrar;
            
            try {
                const { data: existing } = await supabaseClient
                    .from('configuracao')
                    .select('id')
                    .limit(1)
                    .single();

                if (existing) {
                    await supabaseClient
                        .from('configuracao')
                        .update({ mostrar_recados_publicos: mostrar })
                        .eq('id', existing.id);
                }
            } catch (err) {
                console.error('Erro ao atualizar recados p√∫blicos:', err);
            }

            atualizarInterfaceConvidado();
            
            const toggleBg2 = document.getElementById('toggle-bg-recados');
            const toggleDot2 = document.getElementById('toggle-dot-recados');
            
            if (mostrar) {
                toggleBg2.style.backgroundColor = '#6f0000';
                toggleDot2.style.transform = 'translateX(24px)';
            } else {
                toggleBg2.style.backgroundColor = '#d1d5db';
                toggleDot2.style.transform = 'translateX(0)';
            }
        }

        // ==================== NAVEGA√á√ÉO ====================
        function irParaLogin() {
            document.getElementById('guest-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('admin-page').style.display = 'none';
            
            if (temLinkValido) {
                document.getElementById('voltar-button').style.display = 'block';
            }
        }

        function voltarParaConvidado() {
            if (temLinkValido) {
                document.getElementById('guest-page').style.display = 'block';
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('admin-page').style.display = 'none';
            }
        }

        function logout() {
            isAdminLogado = false;
            localStorage.removeItem('adminLogado');
            
            if (temLinkValido) {
                voltarParaConvidado();
            } else {
                document.getElementById('guest-page').style.display = 'none';
                document.getElementById('login-page').style.display = 'flex';
                document.getElementById('admin-page').style.display = 'none';
            }
        }

        // ==================== TAB NAVIGATION ====================
        function mostrarTab(tab) {
            document.getElementById('tab-confirmados').style.backgroundColor = '#e5e7eb';
            document.getElementById('tab-confirmados').style.color = '#666';
            document.getElementById('tab-declinados').style.backgroundColor = '#e5e7eb';
            document.getElementById('tab-declinados').style.color = '#666';
            document.getElementById('tab-recados').style.backgroundColor = '#e5e7eb';
            document.getElementById('tab-recados').style.color = '#666';
            document.getElementById('tab-links').style.backgroundColor = '#e5e7eb';
            document.getElementById('tab-links').style.color = '#666';

            document.getElementById('content-confirmados').style.display = 'none';
            document.getElementById('content-declinados').style.display = 'none';
            document.getElementById('content-recados').style.display = 'none';
            document.getElementById('content-links').style.display = 'none';

            if (tab === 'confirmados') {
                document.getElementById('tab-confirmados').style.backgroundColor = '#8B0000';
                document.getElementById('tab-confirmados').style.color = '#ffffff';
                document.getElementById('content-confirmados').style.display = 'block';
            } else if (tab === 'declinados') {
                document.getElementById('tab-declinados').style.backgroundColor = '#8B0000';
                document.getElementById('tab-declinados').style.color = '#ffffff';
                document.getElementById('content-declinados').style.display = 'block';
            } else if (tab === 'recados') {
                document.getElementById('tab-recados').style.backgroundColor = '#8B0000';
                document.getElementById('tab-recados').style.color = '#ffffff';
                document.getElementById('content-recados').style.display = 'block';
            } else if (tab === 'links') {
                document.getElementById('tab-links').style.backgroundColor = '#8B0000';
                document.getElementById('tab-links').style.color = '#ffffff';
                document.getElementById('content-links').style.display = 'block';
            }
        }

        // ==================== AJUDA ====================
        function mostrarAjuda() {
            const ajudaModal = document.createElement('div');
            ajudaModal.className = 'fixed inset-0 flex items-center justify-center z-50 px-4';
            ajudaModal.style.background = 'rgba(0,0,0,0.7)';
            ajudaModal.innerHTML = `
                <div class="bg-white rounded-3xl p-8 max-w-2xl w-full shadow-2xl max-h-[90vh] overflow-y-auto">
                    <h3 class="text-3xl font-bold mb-6 text-center" style="color: #8B0000;">Guia de Uso do Painel</h3>
                    
                    <div class="space-y-6 text-gray-700">
                        <div class="bg-blue-50 rounded-xl p-5 border-2 border-blue-300">
                            <h4 class="font-bold text-xl mb-3 text-blue-900">1. Como Ver Quem Confirmou</h4>
                            <p class="text-base leading-relaxed">
                                Clique na aba <strong>"Confirmados"</strong> para ver todos que confirmaram presen√ßa.
                            </p>
                        </div>

                        <div class="bg-purple-50 rounded-xl p-5 border-2 border-purple-300">
                            <h4 class="font-bold text-xl mb-3 text-purple-900">2. Como Enviar os Convites</h4>
                            <p class="text-base leading-relaxed mb-3">
                                Clique na aba <strong>"Enviar Convites"</strong>. Copie o link e cole no WhatsApp!
                            </p>
                        </div>

                        <div class="bg-green-50 rounded-xl p-5 border-2 border-green-300">
                            <h4 class="font-bold text-xl mb-3 text-green-900">3. Como Baixar a Lista</h4>
                            <p class="text-base leading-relaxed">
                                Clique no bot√£o <strong>"Baixar Lista em PDF"</strong> no topo da p√°gina.
                            </p>
                        </div>

                        <div class="bg-amber-50 rounded-xl p-5 border-2 border-amber-300">
                            <h4 class="font-bold text-xl mb-3 text-amber-900">4. Como Personalizar</h4>
                            <p class="text-base leading-relaxed">
                                Na aba <strong>"Enviar Convites"</strong>, role at√© o final para editar nome, data e avisos.
                            </p>
                        </div>
                    </div>

                    <button 
                        class="w-full mt-8 py-4 rounded-xl text-white font-bold text-lg fechar-modal-btn" 
                        style="background-color: #8B0000;"
                    >
                        Entendi!
                    </button>
                </div>
            `;
            document.body.appendChild(ajudaModal);
            
            ajudaModal.querySelector('.fechar-modal-btn').addEventListener('click', function() {
                ajudaModal.remove();
            });
        }

        // ==================== CONTAGEM REGRESSIVA ====================
        function atualizarContador() {
            const countdownElement = document.getElementById('countdown');
            if (!countdownElement) return;
            
            // Aguardar configura√ß√£o carregar
            if (!configuracaoEvento.data_evento_timestamp || configuracaoEvento.data_evento_timestamp === new Date('2026-01-15T20:00:00').getTime()) {
                countdownElement.innerHTML = `
                    <div class="col-span-4 text-center">
                        <p class="text-lg text-gray-500">Carregando contagem regressiva...</p>
                    </div>
                `;
                return;
            }
            
            // Usar a data do evento configurada
            const dataEvento = new Date(configuracaoEvento.data_evento_timestamp);
            const agora = new Date();
            const diferenca = dataEvento - agora;

            if (diferenca <= 0) {
                countdownElement.innerHTML = `
                    <div class="col-span-4 text-center">
                        <p class="text-2xl font-bold" style="color: #6f0000;">üéâ O grande dia chegou! üéâ</p>
                    </div>
                `;
                return;
            }

            const dias = Math.floor(diferenca / (1000 * 60 * 60 * 24));
            const horas = Math.floor((diferenca % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutos = Math.floor((diferenca % (1000 * 60 * 60)) / (1000 * 60));
            const segundos = Math.floor((diferenca % (1000 * 60)) / 1000);

            countdownElement.innerHTML = `
                <div class="text-center">
                    <div class="bg-white bg-opacity-80 rounded-xl p-4">
                        <div class="text-3xl font-bold mb-1" style="color: #6f0000;">${dias}</div>
                        <div class="text-xs uppercase tracking-wide" style="color: #5d5d5d;">Dias</div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="bg-white bg-opacity-80 rounded-xl p-4">
                        <div class="text-3xl font-bold mb-1" style="color: #6f0000;">${horas}</div>
                        <div class="text-xs uppercase tracking-wide" style="color: #5d5d5d;">Horas</div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="bg-white bg-opacity-80 rounded-xl p-4">
                        <div class="text-3xl font-bold mb-1" style="color: #6f0000;">${minutos}</div>
                        <div class="text-xs uppercase tracking-wide" style="color: #5d5d5d;">Minutos</div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="bg-white bg-opacity-80 rounded-xl p-4">
                        <div class="text-3xl font-bold mb-1" style="color: #6f0000;">${segundos}</div>
                        <div class="text-xs uppercase tracking-wide" style="color: #5d5d5d;">Segundos</div>
                    </div>
                </div>
            `;
        }

        // ==================== VERIFICAR TIPO DE CONVITE ====================
        function verificarTipoConvite() {
            const params = new URLSearchParams(window.location.search);
            const tipo = params.get('tipo');
            
            if (tipo === 'com') {
                permitirAcompanhante = true;
                temLinkValido = true;
                document.getElementById('acompanhante-field').style.display = 'block';
            } else if (tipo === 'sem') {
                temLinkValido = true;
            }

            const baseUrl = window.location.origin + window.location.pathname;
            document.getElementById('link-sem').value = baseUrl + '?tipo=sem';
            document.getElementById('link-com').value = baseUrl + '?tipo=com';
        }

        // ==================== COPIAR LINK ====================
        function copiarLink(tipo) {
            const input = document.getElementById(`link-${tipo}`);
            input.select();
            input.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                const feedback = document.getElementById('copy-success');
                feedback.style.display = 'block';
                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 3000);
            } catch (err) {
                // Silencioso
            }
        }

        // ==================== CARREGAR DADOS ====================
        async function carregarDados() {
            if (!supabaseClient) return;
            
            try {
                const { data: confirmacoes, error: errorConf } = await supabaseClient
                    .from('confirmacoes')
                    .select('*')
                    .order('created_at', { ascending: false });

                const { data: recados, error: errorRec } = await supabaseClient
                    .from('recados')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (confirmacoes) todasConfirmacoes = confirmacoes;
                if (recados) todosRecados = recados;

                renderizarRecados();
                if (isAdminLogado) {
                    atualizarPainelAdmin();
                }
            } catch (err) {
                console.error('Erro ao carregar dados:', err);
            }
        }

        // ==================== CONFIRMAR PRESEN√áA ====================
        async function confirmarPresenca(e) {
            if (e) e.preventDefault();
            
            if (!supabaseClient) {
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-message').querySelector('p').textContent = 'Erro: Sistema de banco de dados n√£o dispon√≠vel';
                return;
            }
            
            const nomeConvidado = document.getElementById('nome-convidado').value.trim();
            const nomeAcompanhante = document.getElementById('nome-acompanhante').value.trim();
            
            if (!nomeConvidado) {
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-message').querySelector('p').textContent = 'Por favor, preencha seu nome.';
                setTimeout(() => {
                    document.getElementById('error-message').style.display = 'none';
                }, 3000);
                return;
            }

            const confirmacaoExistente = todasConfirmacoes.find(c => 
                c.nome_convidado.toLowerCase() === nomeConvidado.toLowerCase()
            );

            document.getElementById('confirmation-form').style.display = 'none';
            document.getElementById('loading-state').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';

            try {
                if (confirmacaoExistente) {
                    const { error } = await supabaseClient
                        .from('confirmacoes')
                        .update({
                            confirmou_presenca: true,
                            nome_acompanhante: permitirAcompanhante ? nomeAcompanhante : '',
                            tem_acompanhante: permitirAcompanhante && nomeAcompanhante.length > 0
                        })
                        .eq('id', confirmacaoExistente.id);

                    if (error) {
                        console.error('Erro Supabase:', error);
                        throw error;
                    }
                } else {
                    const { error } = await supabaseClient
                        .from('confirmacoes')
                        .insert([{
                            nome_convidado: nomeConvidado,
                            nome_acompanhante: permitirAcompanhante ? nomeAcompanhante : '',
                            tem_acompanhante: permitirAcompanhante && nomeAcompanhante.length > 0,
                            confirmou_presenca: true
                        }]);

                    if (error) {
                        console.error('Erro Supabase:', error);
                        throw error;
                    }
                }

                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('success-state').style.display = 'block';
                usuarioRespondeu = true;
                nomeConvidadoAtual = nomeConvidado;
                localStorage.setItem('nomeConvidado', nomeConvidado);
                document.getElementById('recados-section').style.display = 'block';
                document.getElementById('nome-recado').value = nomeConvidado;
                document.getElementById('nome-recado-field').style.display = 'none';

                await carregarDados();
            } catch (err) {
                console.error('Erro completo:', err);
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-message').querySelector('p').textContent = 'Erro: ' + (err.message || 'Tente novamente');
                document.getElementById('confirmation-form').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('error-message').style.display = 'none';
                }, 5000);
            }
        }

        // ==================== DECLINAR PRESEN√áA ====================
        async function declinarPresenca(e) {
            if (e) e.preventDefault();
            
            if (!supabaseClient) {
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-message').querySelector('p').textContent = 'Erro: Sistema de banco de dados n√£o dispon√≠vel';
                return;
            }
            
            const nomeConvidado = document.getElementById('nome-convidado').value.trim();
            
            if (!nomeConvidado) {
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-message').querySelector('p').textContent = 'Por favor, preencha seu nome.';
                setTimeout(() => {
                    document.getElementById('error-message').style.display = 'none';
                }, 3000);
                return;
            }

            const confirmacaoExistente = todasConfirmacoes.find(c => 
                c.nome_convidado.toLowerCase() === nomeConvidado.toLowerCase()
            );

            document.getElementById('confirmation-form').style.display = 'none';
            document.getElementById('loading-state').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';

            try {
                if (confirmacaoExistente) {
                    const { error } = await supabaseClient
                        .from('confirmacoes')
                        .update({
                            confirmou_presenca: false,
                            nome_acompanhante: '',
                            tem_acompanhante: false
                        })
                        .eq('id', confirmacaoExistente.id);

                    if (error) {
                        console.error('Erro Supabase:', error);
                        throw error;
                    }
                } else {
                    const { error } = await supabaseClient
                        .from('confirmacoes')
                        .insert([{
                            nome_convidado: nomeConvidado,
                            nome_acompanhante: '',
                            tem_acompanhante: false,
                            confirmou_presenca: false
                        }]);

                    if (error) {
                        console.error('Erro Supabase:', error);
                        throw error;
                    }
                }

                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('decline-state').style.display = 'block';
                usuarioRespondeu = true;
                nomeConvidadoAtual = nomeConvidado;
                localStorage.setItem('nomeConvidado', nomeConvidado);
                document.getElementById('recados-section').style.display = 'block';
                document.getElementById('nome-recado').value = nomeConvidado;
                document.getElementById('nome-recado-field').style.display = 'none';

                await carregarDados();
            } catch (err) {
                console.error('Erro completo:', err);
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-message').querySelector('p').textContent = 'Erro: ' + (err.message || 'Tente novamente');
                document.getElementById('confirmation-form').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('error-message').style.display = 'none';
                }, 5000);
            }
        }

        // ==================== EDITAR RESPOSTA ====================
        function editarResposta() {
            document.getElementById('success-state').style.display = 'none';
            document.getElementById('decline-state').style.display = 'none';
            document.getElementById('confirmation-form').style.display = 'block';
            
            const respostaAtual = todasConfirmacoes.find(c => 
                c.nome_convidado.toLowerCase() === nomeConvidadoAtual.toLowerCase()
            );
            
            if (respostaAtual) {
                document.getElementById('nome-convidado').value = respostaAtual.nome_convidado;
                if (respostaAtual.tem_acompanhante) {
                    document.getElementById('nome-acompanhante').value = respostaAtual.nome_acompanhante;
                }
            }
        }

        // ==================== ENVIAR RECADO ====================
        async function enviarRecado(e) {
            e.preventDefault();
            
            if (!supabaseClient) return;
            
            const nome = document.getElementById('nome-recado').value.trim();
            const mensagem = document.getElementById('mensagem-recado').value.trim();
            
            if (!nome || !mensagem) return;

            document.getElementById('recado-form').style.display = 'none';
            document.getElementById('recado-loading').style.display = 'block';
            document.getElementById('recado-error').style.display = 'none';

            try {
                const { error } = await supabaseClient
                    .from('recados')
                    .insert([{
                        nome_convidado: nome,
                        mensagem: mensagem
                    }]);

                if (error) throw error;

                document.getElementById('recado-loading').style.display = 'none';
                document.getElementById('recado-success').style.display = 'block';
                document.getElementById('nome-recado').value = '';
                document.getElementById('mensagem-recado').value = '';
                document.getElementById('char-count').textContent = '0/500 caracteres';
                
                await carregarDados();

                setTimeout(() => {
                    document.getElementById('recado-success').style.display = 'none';
                    document.getElementById('recado-form').style.display = 'block';
                }, 3000);
            } catch (err) {
                console.error('Erro:', err);
                document.getElementById('recado-loading').style.display = 'none';
                document.getElementById('recado-error').style.display = 'block';
                document.getElementById('recado-form').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('recado-error').style.display = 'none';
                }, 3000);
            }
        }

        // ==================== RENDERIZAR RECADOS ====================
        function renderizarRecados() {
            const lista = document.getElementById('lista-recados');
            
            if (todosRecados.length === 0) {
                lista.innerHTML = '<p class="text-gray-400 text-center py-6 text-base">Nenhum recado ainda. Seja o primeiro!</p>';
            } else {
                lista.innerHTML = todosRecados.map(r => {
                    const dataObj = new Date(r.created_at);
                    const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                    
                    return `
                        <div class="bg-gradient-to-br from-amber-50 to-orange-50 border rounded-xl p-4" style="border-color: #d4c4b0;">
                            <div class="flex justify-between items-start mb-2">
                                <div class="font-semibold text-base" style="color: #6f0000;">${r.nome_convidado}</div>
                                <div class="text-xs text-gray-400">${dataFormatada}</div>
                            </div>
                            <p class="text-gray-700 text-sm leading-relaxed">${r.mensagem}</p>
                        </div>
                    `;
                }).join('');
            }
        }

        // ==================== PAINEL ADMIN ====================
        function atualizarPainelAdmin() {
            const confirmados = todasConfirmacoes.filter(c => c.confirmou_presenca);
            const declinados = todasConfirmacoes.filter(c => !c.confirmou_presenca);
            
            const comAcompanhante = confirmados.filter(c => c.tem_acompanhante).length;
            const totalPessoas = confirmados.reduce((acc, c) => {
                return acc + 1 + (c.tem_acompanhante ? 1 : 0);
            }, 0);

            // CORRE√á√ÉO: Contabilizar convidado + acompanhante como pessoas separadas
            document.getElementById('stat-confirmados').textContent = totalPessoas;
            document.getElementById('stat-declinados').textContent = declinados.length;
            document.getElementById('stat-acompanhantes').textContent = comAcompanhante;
            document.getElementById('stat-pessoas').textContent = totalPessoas;
            document.getElementById('stat-recados').textContent = todosRecados.length;

            const listaConfirmados = document.getElementById('confirmations-list');
            if (confirmados.length === 0) {
                listaConfirmados.innerHTML = '<p class="text-gray-400 text-center py-12 text-lg">Nenhuma confirma√ß√£o ainda</p>';
            } else {
                listaConfirmados.innerHTML = confirmados.map(c => {
                    const dataObj = new Date(c.created_at);
                    const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }) + 
                                        ' √†s ' + dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    
                    return `
                        <div class="border-2 rounded-2xl p-5 flex justify-between items-center hover:shadow-lg transition-shadow" style="border-color: #8B0000;">
                            <div class="flex-1">
                                <div class="font-bold text-xl mb-1" style="color: #8B0000;">${c.nome_convidado}</div>
                                ${c.tem_acompanhante ? `<div class="text-sm mb-1" style="color: #666;">Acompanhante: ${c.nome_acompanhante}</div>` : ''}
                                <div class="text-xs" style="color: #999;">Confirmado em ${dataFormatada}</div>
                            </div>
                            <button 
                                class="excluir-btn px-4 py-2 rounded-xl text-white text-sm font-bold hover:opacity-80 transition-opacity" 
                                style="background-color: #dc2626;"
                                data-id="${c.id}"
                            >
                                Excluir
                            </button>
                        </div>
                    `;
                }).join('');
                
                document.querySelectorAll('.excluir-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        excluirConfirmacao(parseInt(this.getAttribute('data-id')));
                    });
                });
            }

            const listaDeclinados = document.getElementById('declines-list');
            if (declinados.length === 0) {
                listaDeclinados.innerHTML = '<p class="text-gray-400 text-center py-12 text-lg">Ningu√©m declinou ainda</p>';
            } else {
                listaDeclinados.innerHTML = declinados.map(c => {
                    const dataObj = new Date(c.created_at);
                    const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }) + 
                                        ' √†s ' + dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    
                    return `
                        <div class="border-2 rounded-2xl p-5 flex justify-between items-center hover:shadow-lg transition-shadow" style="border-color: #666; background-color: #f9fafb;">
                            <div class="flex-1">
                                <div class="font-bold text-xl mb-1" style="color: #666;">${c.nome_convidado}</div>
                                <div class="text-xs" style="color: #999;">Declinou em ${dataFormatada}</div>
                            </div>
                            <button 
                                class="excluir-decline-btn px-4 py-2 rounded-xl text-white text-sm font-bold hover:opacity-80 transition-opacity" 
                                style="background-color: #dc2626;"
                                data-id="${c.id}"
                            >
                                Excluir
                            </button>
                        </div>
                    `;
                }).join('');
                
                document.querySelectorAll('.excluir-decline-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        excluirConfirmacao(parseInt(this.getAttribute('data-id')));
                    });
                });
            }

            const listaRecados = document.getElementById('admin-recados-list');
            if (todosRecados.length === 0) {
                listaRecados.innerHTML = '<p class="text-gray-400 text-center py-12 text-lg">Nenhum recado ainda</p>';
            } else {
                listaRecados.innerHTML = todosRecados.map(r => {
                    const dataObj = new Date(r.created_at);
                    const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }) + 
                                        ' √†s ' + dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    
                    return `
                        <div class="border-2 rounded-2xl p-5 hover:shadow-lg transition-shadow" style="border-color: #FFD700; background: linear-gradient(to right, #fff9e6, #ffffff);">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex-1">
                                    <div class="font-bold text-xl mb-2" style="color: #8B0000;">${r.nome_convidado}</div>
                                    <div class="text-gray-700 text-base mb-2 leading-relaxed">${r.mensagem}</div>
                                    <div class="text-xs" style="color: #999;">Enviado em ${dataFormatada}</div>
                                </div>
                                <button 
                                    class="excluir-recado-btn ml-4 px-4 py-2 rounded-xl text-white text-sm font-bold hover:opacity-80 transition-opacity" 
                                    style="background-color: #dc2626;"
                                    data-id="${r.id}"
                                >
                                    Excluir
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                document.querySelectorAll('.excluir-recado-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        excluirRecado(parseInt(this.getAttribute('data-id')));
                    });
                });
            }
        }

        // ==================== EXCLUIR CONFIRMA√á√ÉO ====================
        async function excluirConfirmacao(id) {
            if (!supabaseClient) return;
            
            const confirmacao = todasConfirmacoes.find(c => c.id === id);
            if (!confirmacao) return;

            const tipoTexto = confirmacao.confirmou_presenca ? 'confirma√ß√£o' : 'decl√≠nio';
            
            const confirmarExclusao = document.createElement('div');
            confirmarExclusao.className = 'fixed inset-0 flex items-center justify-center z-50 px-4';
            confirmarExclusao.style.background = 'rgba(0,0,0,0.5)';
            confirmarExclusao.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
                    <h3 class="text-2xl font-bold mb-4" style="color: #8B0000;">Confirmar Exclus√£o</h3>
                    <p class="mb-6 text-gray-700">Deseja realmente excluir a ${tipoTexto} de <strong>${confirmacao.nome_convidado}</strong>?</p>
                    <div class="flex gap-3">
                        <button 
                            class="cancelar-exclusao flex-1 py-3 rounded-xl border-2 font-bold" 
                            style="border-color: #8B0000; color: #8B0000;"
                        >
                            Cancelar
                        </button>
                        <button 
                            class="confirmar-exclusao-btn flex-1 py-3 rounded-xl text-white font-bold" 
                            style="background-color: #dc2626;"
                            data-id="${id}"
                        >
                            Excluir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmarExclusao);
            
            confirmarExclusao.querySelector('.cancelar-exclusao').addEventListener('click', function() {
                confirmarExclusao.remove();
            });
            
            confirmarExclusao.querySelector('.confirmar-exclusao-btn').addEventListener('click', async function() {
                const modal = confirmarExclusao;
                modal.remove();

                try {
                    const { error } = await supabaseClient
                        .from('confirmacoes')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;

                    await carregarDados();
                } catch (err) {
                    console.error('Erro ao excluir:', err);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border-2 border-red-400 px-6 py-3 rounded-xl shadow-lg z-50';
                    errorDiv.innerHTML = '<p class="text-red-800 font-bold">Erro ao excluir. Tente novamente.</p>';
                    document.body.appendChild(errorDiv);
                    setTimeout(() => errorDiv.remove(), 3000);
                }
            });
        }

        // ==================== EXCLUIR RECADO ====================
        async function excluirRecado(id) {
            if (!supabaseClient) return;
            
            const recado = todosRecados.find(r => r.id === id);
            if (!recado) return;

            const confirmarExclusao = document.createElement('div');
            confirmarExclusao.className = 'fixed inset-0 flex items-center justify-center z-50 px-4';
            confirmarExclusao.style.background = 'rgba(0,0,0,0.5)';
            confirmarExclusao.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
                    <h3 class="text-2xl font-bold mb-4" style="color: #8B0000;">Confirmar Exclus√£o</h3>
                    <p class="mb-6 text-gray-700">Deseja realmente excluir o recado de <strong>${recado.nome_convidado}</strong>?</p>
                    <div class="flex gap-3">
                        <button 
                            class="cancelar-exclusao-recado flex-1 py-3 rounded-xl border-2 font-bold" 
                            style="border-color: #8B0000; color: #8B0000;"
                        >
                            Cancelar
                        </button>
                        <button 
                            class="confirmar-exclusao-recado-btn flex-1 py-3 rounded-xl text-white font-bold" 
                            style="background-color: #dc2626;"
                            data-id="${id}"
                        >
                            Excluir
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmarExclusao);
            
            confirmarExclusao.querySelector('.cancelar-exclusao-recado').addEventListener('click', function() {
                confirmarExclusao.remove();
            });
            
            confirmarExclusao.querySelector('.confirmar-exclusao-recado-btn').addEventListener('click', async function() {
                const modal = confirmarExclusao;
                modal.remove();

                try {
                    const { error } = await supabaseClient
                        .from('recados')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;

                    await carregarDados();
                } catch (err) {
                    console.error('Erro ao excluir:', err);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border-2 border-red-400 px-6 py-3 rounded-xl shadow-lg z-50';
                    errorDiv.innerHTML = '<p class="text-red-800 font-bold">Erro ao excluir. Tente novamente.</p>';
                    document.body.appendChild(errorDiv);
                    setTimeout(() => errorDiv.remove(), 3000);
                }
            });
        }

        // ==================== EXPORTAR PDF ====================
        function exportarPDF() {
            const confirmados = todasConfirmacoes.filter(c => c.confirmou_presenca);
            const declinados = todasConfirmacoes.filter(c => !c.confirmou_presenca);
            
            if (todasConfirmacoes.length === 0 && todosRecados.length === 0) {
                const aviso = document.createElement('div');
                aviso.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-yellow-100 border-2 border-yellow-400 px-6 py-3 rounded-xl shadow-lg z-50';
                aviso.innerHTML = '<p class="text-yellow-800 font-bold">Nenhuma informa√ß√£o para exportar</p>';
                document.body.appendChild(aviso);
                setTimeout(() => aviso.remove(), 3000);
                return;
            }

            const comAcompanhante = confirmados.filter(c => c.tem_acompanhante).length;
            const totalPessoas = confirmados.reduce((acc, c) => acc + 1 + (c.tem_acompanhante ? 1 : 0), 0);

            const printWindow = window.open('', '_blank');
            
            const html = `
                <!DOCTYPE html>
                <html lang="pt-BR">
                <head>
                    <meta charset="UTF-8">
                    <title>Lista de Confirma√ß√µes</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap');
                        
                        body {
                            font-family: 'Quicksand', sans-serif;
                            padding: 40px;
                            max-width: 900px;
                            margin: 0 auto;
                            color: #333;
                        }
                        
                        .header {
                            text-align: center;
                            margin-bottom: 40px;
                            padding-bottom: 20px;
                            border-bottom: 4px solid #8B0000;
                        }
                        
                        .header h1 {
                            font-weight: 700;
                            color: #8B0000;
                            font-size: 42px;
                            margin: 0 0 10px 0;
                        }
                        
                        .header p {
                            color: #666;
                            margin: 12px 0 0 0;
                            font-size: 18px;
                        }
                        
                        .stats {
                            display: grid;
                            grid-template-columns: repeat(3, 1fr);
                            gap: 20px;
                            margin-bottom: 40px;
                        }
                        
                        .stat-box {
                            background: #f5f5f5;
                            padding: 25px;
                            border-radius: 12px;
                            text-align: center;
                            border: 3px solid #8B0000;
                        }
                        
                        .stat-box .number {
                            font-size: 40px;
                            font-weight: bold;
                            color: #8B0000;
                            margin-bottom: 8px;
                        }
                        
                        .stat-box .label {
                            color: #666;
                            font-size: 16px;
                            font-weight: 600;
                        }
                        
                        .guest-list h3 {
                            color: #8B0000;
                            font-size: 24px;
                            margin-bottom: 25px;
                            padding-bottom: 12px;
                            border-bottom: 3px solid #FFD700;
                        }
                        
                        .guest-item {
                            background: #ffffff;
                            border: 2px solid #ddd;
                            border-radius: 12px;
                            padding: 20px;
                            margin-bottom: 15px;
                            page-break-inside: avoid;
                        }
                        
                        .guest-name {
                            font-size: 20px;
                            font-weight: bold;
                            color: #8B0000;
                            margin-bottom: 8px;
                        }
                        
                        .guest-companion {
                            color: #666;
                            font-size: 16px;
                            margin-left: 24px;
                            margin-bottom: 6px;
                        }
                        
                        .guest-date {
                            color: #999;
                            font-size: 13px;
                            margin-top: 8px;
                        }
                        
                        .decline-item {
                            background: #f9fafb;
                            border: 2px solid #999;
                        }
                        
                        .decline-item .guest-name {
                            color: #666;
                        }
                        
                        .footer {
                            margin-top: 50px;
                            text-align: center;
                            color: #999;
                            font-size: 13px;
                            padding-top: 20px;
                            border-top: 2px solid #ddd;
                        }
                        
                        @media print {
                            body { padding: 20px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${configuracaoEvento.nome_aniversariante}</h1>
                        <p>${configuracaoEvento.data_evento}</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-box">
                            <div class="number">${totalPessoas}</div>
                            <div class="label">Confirmados</div>
                        </div>
                        <div class="stat-box">
                            <div class="number">${comAcompanhante}</div>
                            <div class="label">Com Acompanhante</div>
                        </div>
                        <div class="stat-box">
                            <div class="number">${totalPessoas}</div>
                            <div class="label">Total de Pessoas</div>
                        </div>
                    </div>
                    
                    <div class="guest-list">
                        <h3>Convidados Confirmados</h3>
                        ${confirmados.length === 0 ? '<p style="text-align: center; color: #999;">Nenhuma confirma√ß√£o ainda</p>' : confirmados.map((c, index) => {
                            const dataObj = new Date(c.created_at);
                            const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }) + 
                                                ' √†s ' + dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                            
                            return `
                                <div class="guest-item">
                                    <div class="guest-name">${index + 1}. ${c.nome_convidado}</div>
                                    ${c.tem_acompanhante ? `<div class="guest-companion">Acompanhante: ${c.nome_acompanhante}</div>` : ''}
                                    <div class="guest-date">Confirmado em: ${dataFormatada}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    ${declinados.length > 0 ? `
                    <div class="guest-list" style="margin-top: 50px;">
                        <h3>Convidados que Declinaram</h3>
                        ${declinados.map((c, index) => {
                            const dataObj = new Date(c.created_at);
                            const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' }) + 
                                                ' √†s ' + dataObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                            
                            return `
                                <div class="guest-item decline-item">
                                    <div class="guest-name">${index + 1}. ${c.nome_convidado}</div>
                                    <div class="guest-date">Declinou em: ${dataFormatada}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    ` : ''}
                    
                    ${todosRecados.length > 0 ? `
                    <div class="guest-list" style="margin-top: 50px;">
                        <h3>Recados dos Convidados</h3>
                        ${todosRecados.map((r, index) => {
                            const dataObj = new Date(r.created_at);
                            const dataFormatada = dataObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                            
                            return `
                                <div class="guest-item" style="background: linear-gradient(to right, #fff9e6, #ffffff);">
                                    <div class="guest-name">${index + 1}. ${r.nome_convidado}</div>
                                    <div style="color: #333; font-size: 16px; line-height: 1.6; margin: 12px 0;">${r.mensagem}</div>
                                    <div class="guest-date">Enviado em: ${dataFormatada}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    ` : ''}
                    
                    <div class="footer">
                        <p>Documento gerado em ${new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' })} √†s ${new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</p>
                    </div>
                    
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                            }, 500);
                        }
                    <\/script>
                </body>
                </html>
            `;
            
            printWindow.document.write(html);
            printWindow.document.close();
        }

        // ==================== VERIFICAR ESTADO INICIAL ====================
        function verificarEstadoInicial() {
            const params = new URLSearchParams(window.location.search);
            const tipo = params.get('tipo');
            const nomeConvidadoSalvo = localStorage.getItem('nomeConvidado');
            const adminLogado = localStorage.getItem('adminLogado');

            // SE EXISTE ?tipo= NA URL, SEMPRE MOSTRA P√ÅGINA DO CONVIDADO
            if (tipo === 'sem' || tipo === 'com') {
                // Limpar login admin se existir
                localStorage.removeItem('adminLogado');
                isAdminLogado = false;
                
                document.getElementById('guest-page').style.display = 'block';
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('admin-page').style.display = 'none';
                document.getElementById('admin-link').style.display = 'block';

                if (nomeConvidadoSalvo) {
                    setTimeout(() => {
                        const resposta = todasConfirmacoes.find(c => 
                            c.nome_convidado.toLowerCase() === nomeConvidadoSalvo.toLowerCase()
                        );

                        if (resposta) {
                            usuarioRespondeu = true;
                            nomeConvidadoAtual = nomeConvidadoSalvo;
                            
                            document.getElementById('confirmation-form').style.display = 'none';
                            document.getElementById('recados-section').style.display = 'block';
                            document.getElementById('nome-recado').value = nomeConvidadoSalvo;
                            document.getElementById('nome-recado-field').style.display = 'none';

                            if (resposta.confirmou_presenca) {
                                document.getElementById('success-state').style.display = 'block';
                            } else {
                                document.getElementById('decline-state').style.display = 'block';
                            }
                        }
                    }, 500);
                }
                
                return;
            }

            // SE N√ÉO TEM ?tipo= NA URL
            if (adminLogado === 'true') {
                isAdminLogado = true;
                document.getElementById('guest-page').style.display = 'none';
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('admin-page').style.display = 'block';
                
                document.getElementById('edit-nome').value = configuracaoEvento.nome_aniversariante;
                document.getElementById('edit-data').value = configuracaoEvento.data_evento;
                document.getElementById('edit-aviso').value = configuracaoEvento.aviso_criancas;
                document.getElementById('edit-username').value = configuracaoEvento.admin_username;
                
                if (configuracaoEvento.data_limite_confirmacao) {
                    document.getElementById('edit-data-limite').value = configuracaoEvento.data_limite_confirmacao;
                }
                
                // Preencher data e hora do evento
                if (configuracaoEvento.data_evento_timestamp) {
                    const dataEvento = new Date(configuracaoEvento.data_evento_timestamp);
                    const ano = dataEvento.getFullYear();
                    const mes = String(dataEvento.getMonth() + 1).padStart(2, '0');
                    const dia = String(dataEvento.getDate()).padStart(2, '0');
                    const hora = String(dataEvento.getHours()).padStart(2, '0');
                    const minuto = String(dataEvento.getMinutes()).padStart(2, '0');
                    document.getElementById('edit-data-evento-timestamp').value = `${ano}-${mes}-${dia}T${hora}:${minuto}`;
                }
                
                carregarDados();
                return;
            }

            // Caso padr√£o: mostrar login
            document.getElementById('guest-page').style.display = 'none';
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('admin-page').style.display = 'none';
            document.getElementById('voltar-button').style.display = 'none';
        }

        // ==================== BLOQUEAR COPIAR/COLAR ====================
        document.addEventListener('copy', function(e) {
            e.preventDefault();
            return false;
        });
        
        document.addEventListener('cut', function(e) {
            e.preventDefault();
            return false;
        });
        
        document.addEventListener('paste', function(e) {
            e.preventDefault();
            return false;
        });
        
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        // ==================== INICIALIZA√á√ÉO ====================
        document.addEventListener('DOMContentLoaded', function() {
            verificarTipoConvite();
            atualizarContador();
            setInterval(atualizarContador, 1000);
            carregarConfiguracao();
            carregarDados();
            verificarEstadoInicial();
            
            // Event Listeners
            document.getElementById('confirmation-form').addEventListener('submit', confirmarPresenca);
            document.getElementById('submit-button-declinar').addEventListener('click', declinarPresenca);
            document.getElementById('editar-resposta-btn').addEventListener('click', editarResposta);
            document.getElementById('editar-resposta-btn2').addEventListener('click', editarResposta);
            document.getElementById('ir-login-btn').addEventListener('click', irParaLogin);
            document.getElementById('voltar-button').addEventListener('click', voltarParaConvidado);
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;

                if (username === configuracaoEvento.admin_username && password === configuracaoEvento.admin_password) {
                    isAdminLogado = true;
                    localStorage.setItem('adminLogado', 'true');
                    document.getElementById('login-page').style.display = 'none';
                    document.getElementById('admin-page').style.display = 'block';
                    document.getElementById('login-error').style.display = 'none';
                    
                    document.getElementById('edit-nome').value = configuracaoEvento.nome_aniversariante;
                    document.getElementById('edit-data').value = configuracaoEvento.data_evento;
                    document.getElementById('edit-aviso').value = configuracaoEvento.aviso_criancas;
                    document.getElementById('edit-username').value = configuracaoEvento.admin_username;
                    document.getElementById('edit-password').value = '';
                    
                    if (configuracaoEvento.data_limite_confirmacao) {
                        document.getElementById('edit-data-limite').value = configuracaoEvento.data_limite_confirmacao;
                    }
                    
                    // Preencher data e hora do evento
                    if (configuracaoEvento.data_evento_timestamp) {
                        const dataEvento = new Date(configuracaoEvento.data_evento_timestamp);
                        const ano = dataEvento.getFullYear();
                        const mes = String(dataEvento.getMonth() + 1).padStart(2, '0');
                        const dia = String(dataEvento.getDate()).padStart(2, '0');
                        const hora = String(dataEvento.getHours()).padStart(2, '0');
                        const minuto = String(dataEvento.getMinutes()).padStart(2, '0');
                        document.getElementById('edit-data-evento-timestamp').value = `${ano}-${mes}-${dia}T${hora}:${minuto}`;
                    }
                    
                    carregarDados();
                } else {
                    document.getElementById('login-error').style.display = 'block';
                }
            });
            
            document.getElementById('tab-confirmados').addEventListener('click', () => mostrarTab('confirmados'));
            document.getElementById('tab-declinados').addEventListener('click', () => mostrarTab('declinados'));
            document.getElementById('tab-recados').addEventListener('click', () => mostrarTab('recados'));
            document.getElementById('tab-links').addEventListener('click', () => mostrarTab('links'));
            document.getElementById('mostrar-ajuda-btn').addEventListener('click', mostrarAjuda);
            document.getElementById('exportar-pdf-btn').addEventListener('click', exportarPDF);
            document.getElementById('copiar-sem-btn').addEventListener('click', () => copiarLink('sem'));
            document.getElementById('copiar-com-btn').addEventListener('click', () => copiarLink('com'));
            document.getElementById('salvar-config-btn').addEventListener('click', salvarConfiguracao);
            document.getElementById('toggle-bg').addEventListener('click', function() {
                const checkbox = document.getElementById('toggle-aviso-criancas');
                checkbox.checked = !checkbox.checked;
                toggleAvisoCriancas(checkbox.checked);
            });
            document.getElementById('toggle-bg-recados').addEventListener('click', function() {
                const checkbox = document.getElementById('toggle-recados-publicos');
                checkbox.checked = !checkbox.checked;
                toggleRecadosPublicos(checkbox.checked);
            });
            document.getElementById('mensagem-recado').addEventListener('input', function(e) {
                const count = e.target.value.length;
                document.getElementById('char-count').textContent = `${count}/500 caracteres`;
            });
            document.getElementById('recado-form').addEventListener('submit', enviarRecado);
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b67f93f04e6c13d',t:'MTc2NzE2NTE5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>